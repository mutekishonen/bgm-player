<!-- 티스토리용 세련된 미니 BGM 플레이어 -->
<div id="tistory-bgm-player" style="
  position: fixed; bottom: 20px; right: 20px;
  background: rgba(0,0,0,0.6); color: white;
  padding: 8px 12px; border-radius: 14px;
  font-family: 'Noto Sans KR', sans-serif;
  display: flex; align-items: center; gap: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  z-index: 9999;
  width: 270px;
  height: 60px;
  overflow: hidden;
">

  <!-- 제목 스크롤 영역 -->
  <div style="flex:1; overflow:hidden; white-space:nowrap;">
    <span id="bgm-title" style="
      display:inline-block;
      animation: scrollTitle 12s linear infinite;
      font-size:14px;
    ">로딩 중...</span>
  </div>

  <!-- 파도 애니메이션 -->
  <div id="visualizer" style="display:flex; gap:2px; align-items:flex-end; height:16px;">
    <div style="width:2px; height:6px; background:#fff; animation:wave 1s infinite ease-in-out alternate;"></div>
    <div style="width:2px; height:10px; background:#fff; animation:wave 1s infinite ease-in-out alternate 0.2s;"></div>
    <div style="width:2px; height:14px; background:#fff; animation:wave 1s infinite ease-in-out alternate 0.4s;"></div>
  </div>

  <!-- 컨트롤 -->
  <button id="bgm-prev" style="background:none; border:none; color:white; font-size:16px; cursor:pointer;">⏮</button>
  <button id="bgm-play" style="background:none; border:none; color:white; font-size:16px; cursor:pointer;">⏯</button>
  <button id="bgm-next" style="background:none; border:none; color:white; font-size:16px; cursor:pointer;">⏭</button>
  <audio id="bgm-audio"></audio>
</div>

<style>
@keyframes scrollTitle {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

@keyframes wave {
  from { height: 4px; opacity:0.6; }
  to { height: 16px; opacity:1; }
}
</style>

<script>
const playlist = [
  { title: "ハジマリビート - UniChØrd", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/ハジマリビート-3-UniChØrd.mp3" },
  { title: "Imitation - Will Stetson X HoYoFair", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/Imitation - Will Stetson x HoYoFair.mp3" },
  { title: "プレイ - Giga", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/プレイ-1-Giga.mp3" },
  { title: "GAL's Life! (feat. KOTONEHOUSE) - DENONBU", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/GAL's Life! (feat. KOTONOHOUSE....mp3" },
  { title: "SOMETHING AIN’T RIGHT - XG", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/SOMETHING AIN'T RIGHT-1-XG.mp3" },
  { title: "DASH - NMIXX", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/DASH-1-NMIXX.mp3" },
  { title: "Password - 트리플에스", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/Password-1-트리플에스.mp3" },
  { title: "Lucky Strike - Maroon 5", url: "https://raw.githubusercontent.com/mutekishonen/bgm-player/main/Lucky Strike-4-Maroon 5.mp3" }
];

const audio = document.getElementById("bgm-audio");
const titleEl = document.getElementById("bgm-title");
const playBtn = document.getElementById("bgm-play");
const nextBtn = document.getElementById("bgm-next");
const prevBtn = document.getElementById("bgm-prev");
const visualizer = document.getElementById("visualizer");

let currentIndex = parseInt(localStorage.getItem("bgmIndex")) || 0;
let currentTime = parseFloat(localStorage.getItem("bgmTime")) || 0;
let wasPlaying = localStorage.getItem("bgmPlaying") === "true";
let wasMuted = localStorage.getItem("bgmMuted") === "true";

function loadSong(index) {
  const song = playlist[index];
  titleEl.textContent = song.title;
  audio.src = song.url;
  audio.currentTime = currentTime;
  audio.muted = wasMuted;
  if (wasPlaying) {
    audio.play().catch(()=>{});
    visualizer.style.opacity = "1";
  } else {
    visualizer.style.opacity = "0.3";
  }
}

playBtn.addEventListener("click", () => {
  if (audio.paused) {
    audio.play();
    wasPlaying = true;
    visualizer.style.opacity = "1";
  } else {
    audio.pause();
    wasPlaying = false;
    visualizer.style.opacity = "0.3";
  }
  saveState();
});

nextBtn.addEventListener("click", () => {
  currentIndex = (currentIndex + 1) % playlist.length;
  currentTime = 0;
  loadSong(currentIndex);
  saveState();
});

prevBtn.addEventListener("click", () => {
  currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
  currentTime = 0;
  loadSong(currentIndex);
  saveState();
});

audio.addEventListener("ended", () => {
  currentIndex = (currentIndex + 1) % playlist.length;
  currentTime = 0;
  loadSong(currentIndex);
  saveState();
});

function saveState() {
  localStorage.setItem("bgmIndex", currentIndex);
  localStorage.setItem("bgmTime", audio.currentTime);
  localStorage.setItem("bgmPlaying", !audio.paused);
  localStorage.setItem("bgmMuted", audio.muted);
}

window.addEventListener("beforeunload", saveState);

window.addEventListener("load", () => {
  loadSong(currentIndex);
});
</script>



